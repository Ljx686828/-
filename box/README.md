# 1.85C-box 显示终端项目

## 项目概述

这是ESP32鱼菜共生系统的1.85C-box显示终端项目。通过串口与ESP32系统通信，在圆形触摸屏上显示系统状态，并提供触摸交互控制。

## 项目结构

```
box/
├── platformio.ini      # PlatformIO项目配置
├── src/
│   ├── main.cpp       # 主程序
│   ├── serial_comm.h/cpp    # 串口通信模块
│   ├── touchscreen.h/cpp    # 触摸屏驱动
│   ├── gui.h/cpp            # LVGL GUI核心
│   ├── gui_components.h/cpp # GUI组件
│   ├── gui_educational.h/cpp # 教育友好界面特性
│   └── audio.h/cpp          # 音频反馈
└── README.md           # 本文件
```

## 硬件要求

- ESP32-S3 1.85C-box 触摸屏开发板（带speaker版本）
- 360×360圆形LCD显示屏
- 电容触摸屏
- 板载音频解码芯片和扬声器

## 功能特性

### 1. 串口通信
- 通过UART接收ESP32系统状态数据
- 发送控制命令给ESP32
- 数据包格式：带校验和的自定义协议

### 2. GUI显示
- 圆形界面布局（适配360×360屏幕）
- 实时显示系统状态：
  - 温度显示（大号数字，颜色指示）
  - 水位状态（安全/危险）
  - 水泵状态（运行/停止，进度条）
  - 流量显示
  - 优先级级别显示
  - 系统消息

### 3. 触摸交互
- 手动控制按钮（启动/停止水泵）
- 触摸事件处理
- 按钮动画反馈

### 4. 教育友好特性
- 水流动画（水泵运行时）
- 温度颜色渐变
- 水位警告闪烁
- 按钮交互动画
- 操作成功/失败动画

### 5. 音频反馈
- 按钮点击音
- 警报音（水位危险、温度异常）
- 操作成功音
- 水泵启动/停止音

## 编译和上传

### 前置要求
- PlatformIO IDE 或 PlatformIO CLI
- ESP32-S3开发环境

### 编译步骤

1. 打开PlatformIO项目
2. 选择环境：`esp32-s3-1.85c-box`
3. 编译：`pio run`
4. 上传：`pio run -t upload`

### 串口配置

- **ESP32端**：使用Serial2（GPIO16/17，可配置）
- **1.85C-box端**：使用Serial2（GPIO43/44）
- **波特率**：115200

## 硬件连接

### ESP32 ↔ 1.85C-box 串口连接

```
ESP32         1.85C-box
------        ---------
GPIO 17  ---> GPIO 44 (RX)
GPIO 16  <--- GPIO 43 (TX)
GND      ---> GND
```

**注意**：实际引脚可能需要根据硬件调整，请参考：
- `src/serial_protocol.cpp` 中的 `SERIAL2_TX_PIN` 和 `SERIAL2_RX_PIN`
- `box/src/serial_comm.cpp` 中的 `SERIAL_COMM_TX_PIN` 和 `SERIAL_COMM_RX_PIN`

## 使用说明

### 启动顺序

1. 先启动ESP32系统（确保传感器和执行器正常工作）
2. 再启动1.85C-box显示终端
3. 1.85C-box会自动连接并显示ESP32系统状态

### 操作方式

1. **查看系统状态**：界面自动更新显示
2. **手动控制水泵**：点击屏幕上的"启动水泵"按钮
3. **查看优先级**：左上角显示当前优先级级别（L1-L4）

### 状态指示

- **温度颜色**：
  - 蓝色：温度过低（<20°C）
  - 绿色：正常范围（20-28°C）
  - 红色：温度过高（>28°C）

- **水位状态**：
  - 绿色"安全"：水位正常
  - 红色"危险"：水位过低，系统已自动停止水泵

- **水泵状态**：
  - 绿色"运行"：水泵正在运行
  - 灰色"停止"：水泵已停止
  - 进度条：显示剩余运行时间

## 开发说明

### 待完善的功能

由于LVGL和硬件驱动的具体实现需要根据实际硬件配置，以下部分提供了框架和接口：

1. **LVGL显示驱动**：需要根据GC9A01芯片配置SPI接口
2. **触摸屏驱动**：需要根据实际触摸芯片（GT911/FT5206等）实现I2C读取
3. **音频驱动**：需要根据板载音频解码芯片配置音频输出

### 代码框架

所有模块都提供了完整的代码框架和接口定义，实际使用时需要：

1. 根据硬件规格配置引脚定义
2. 实现硬件特定的驱动函数
3. 完善LVGL的显示和输入设备配置

### 调试

- 使用Serial Monitor查看调试信息（115200波特率）
- 检查串口通信数据包
- 验证触摸事件和GUI更新

## 注意事项

1. **引脚配置**：确保ESP32和1.85C-box的串口引脚配置正确
2. **电源**：确保两个设备共地（GND连接）
3. **波特率**：两端串口波特率必须一致（115200）
4. **数据包格式**：严格按照协议格式发送和接收数据
5. **LVGL配置**：需要根据实际硬件配置LVGL显示驱动

## 许可证

MIT License

